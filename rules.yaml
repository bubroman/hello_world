rules:
  validators: 
    my_rules:
      title: Валидаторы
    my_rules.welcome:
      title: Проверка Wellcome
      description: Проверка главной страницы
      source: >
       (
          $manifest := $;
          $matcher := /dochub.welcome/; /*Задаем параметр фильтрации запроса*/
          [$not($exists($manifest.docs.$sift(function($v, $k) {$k ~> $matcher}))) ? {
            "uid": "$dh-mm-nfwp",
            "title": "Не найден документа главной страницы",
            "description": "Не найден документа главной страницы",
            "correction": "Подключите свою главную страницу в соответствии с инструкцией описанной при входе",
            "location": "@document/dochub.welcome",
            "path": "/docs/dochub.welcome"  
          }]; 
       )
       
    my_rules.diagram_l1:
      title: Уровень
      description: Проверка уровня L1
      source: >
        (
           $manifest := $;
           $systems := $manifest.components.$sift(function($v) { $v.entity="system" });
           [$not([$systems]) ? {
              "uid": "$dh-mm-nfs",
              "title": "Нет ни одной системы",
              "description": "Не найдено ни одной описанной информационной системы",
              "correction": "Опишите свои системы в соответствии с инструкцией",
              "location": "@component",
              "path": "/components"  
            }];
        )      

    my_rules.swagger:
      title: Swagger
      description: Проверка наличия swagger
      source: >
        (
            $manifest := $;	
            $value := "openapi"; 	
            [$not([docs.$filter($.*, function($v, $i, $a) {$contains($v."type", $value)}).($)]) ? {
               "uid": "$dh-mm-nfapi",
               "title": "Нет ни одного контракта swagger",
               "description": "Не найдено ни одного описанного контракта swagger",
               "correction": "Опишите свои контракты swagger в соответствии с инструкцией",
               "location": "@document",
               "path": "/docs"  
            }];        
        )

    my_rules.business:
      title: Бизнес-процесс
      description: Наличие бизнес-процесса
      source: >
        (            
            $manifest := $;	
            $value := "bpmnjs"; 	
            [$not([docs.$filter($.*, function($v, $i, $a) {$contains($v."type", $value)}).($)]) ? {
               "uid": "$dh-mm-nfbp",
               "title": "Нет ни одного описанного БП",
               "description": "Не найдено ни одного описанного бизнес-процесса",
               "correction": "Опишите свои бизнес-процессы в соответствии с инструкцией",
               "location": "@document",
               "path": "/docs"  
            }];     
        )